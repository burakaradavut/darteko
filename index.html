<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dart Cricket Pro</title>
    <style>
        :root {
            /* Premium Palette: Titanium & Deep Sea */
            --bg-body: #050608;
            --bg-card: #12141c;
            --bg-input: #0a0b10;
            
            --accent-primary: #3b82f6; /* Modern Blue */
            --accent-glow: rgba(59, 130, 246, 0.4);
            --accent-success: #10b981; /* Emerald */
            
            --text-white: #f3f4f6;
            --text-gray: #9ca3af;
            
            --border-subtle: rgba(255, 255, 255, 0.08);
            --font-main: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", Roboto, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-white);
            font-family: var(--font-main);
            overflow-x: hidden; padding-bottom: 80px;
            min-height: 100vh;
        }

        /* --- Ambient Background (Non-Intrusive) --- */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% -20%, rgba(59, 130, 246, 0.15), transparent 60%),
                radial-gradient(circle at 90% 90%, rgba(16, 185, 129, 0.05), transparent 40%);
            z-index: -1; pointer-events: none;
        }

        /* --- Layout Container (Fix for click issues) --- */
        .container { 
            position: relative; 
            z-index: 10; /* Ensures content is above background */
            max-width: 550px; 
            margin: 90px auto 0; 
            padding: 0 20px; 
        }

        /* --- Dynamic Island --- */
        .island-wrap {
            position: fixed; top: 16px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 100; pointer-events: none;
        }
        .island {
            pointer-events: auto;
            background: rgba(20, 20, 22, 0.95);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            width: 92%; max-width: 380px; height: 56px;
            border-radius: 28px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 8px 0 20px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(255,255,255,0.1);
            transition: transform 0.2s; cursor: pointer;
        }
        .island:active { transform: scale(0.97); }

        .island-left { display: flex; align-items: center; gap: 14px; }
        .eq-bars { display: flex; align-items: flex-end; gap: 3px; height: 16px; }
        .bar { width: 3px; background: var(--accent-success); border-radius: 4px; animation: eq 1.2s infinite ease-in-out; }
        .bar:nth-child(2) { animation-delay: 0.2s; height: 60%; }
        .bar:nth-child(3) { animation-delay: 0.4s; height: 30%; }
        @keyframes eq { 0%, 100% { height: 4px; } 50% { height: 16px; } }

        .island-info h4 { margin: 0; font-size: 13px; font-weight: 600; letter-spacing: -0.2px; }
        .island-info p { margin: 0; font-size: 11px; color: var(--text-gray); }

        .island-btn {
            background: #27272a; color: var(--accent-success);
            font-size: 11px; font-weight: 700; padding: 10px 16px; border-radius: 20px;
        }

        /* --- Main UI Cards --- */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.3);
        }

        header { text-align: center; margin-bottom: 30px; }
        h1 {
            margin: 0; font-size: 32px; font-weight: 800; letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .subtitle { font-size: 13px; color: var(--accent-primary); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-top: 6px; }

        /* --- Buttons & Inputs --- */
        .btn-main {
            width: 100%; border: none; padding: 16px; border-radius: 16px;
            background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
            color: white; font-weight: 700; font-size: 16px; cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.2s;
        }
        .btn-main:active { transform: scale(0.98); filter: brightness(0.9); }

        .input-box { margin-bottom: 12px; }
        input[type="text"] {
            width: 100%; background: var(--bg-input);
            border: 1px solid #333; border-radius: 12px;
            padding: 14px; color: #fff; font-size: 16px; outline: none;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--accent-primary); }

        .tab-group { display: flex; gap: 8px; margin-bottom: 20px; background: var(--bg-input); padding: 4px; border-radius: 14px; }
        .tab-btn {
            flex: 1; background: transparent; border: none; color: var(--text-gray);
            padding: 10px; border-radius: 10px; font-weight: 600; font-size: 13px; cursor: pointer;
        }
        .tab-btn.active { background: #27272a; color: #fff; shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* --- Game Grid --- */
        .board { display: grid; gap: 8px; }
        .grid-2 { grid-template-columns: 1fr 60px 1fr; }
        .grid-3 { grid-template-columns: 50px 1fr 1fr 1fr; }

        .th { text-align: center; font-size: 12px; font-weight: 700; color: var(--accent-primary); padding-bottom: 8px; text-transform: uppercase; }

        .target {
            height: 50px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: 800; color: #fff;
            background: #1f2937; border-radius: 10px;
        }

        .cell {
            height: 50px; background: rgba(255,255,255,0.03); border-radius: 10px;
            border: 1px solid transparent; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.1s;
        }
        .cell:active { background: rgba(255,255,255,0.1); }

        /* --- Marks (Clean & Sharp) --- */
        .mark { pointer-events: none; }
        
        /* Hit 1 - Blue Slash */
        .h1 { border-color: rgba(59, 130, 246, 0.5); background: rgba(59, 130, 246, 0.1); }
        .h1 .mark { width: 4px; height: 26px; background: var(--accent-primary); transform: rotate(45deg); border-radius: 2px; }
        
        /* Hit 2 - Blue Cross */
        .h2 { border-color: rgba(59, 130, 246, 0.5); background: rgba(59, 130, 246, 0.1); }
        .h2 .mark { width: 26px; height: 26px; position: relative; }
        .h2 .mark::before, .h2 .mark::after { 
            content:''; position: absolute; top:0; left:11px; width:4px; height:26px; 
            background: var(--accent-primary); border-radius: 2px; 
        }
        .h2 .mark::before { transform: rotate(45deg); }
        .h2 .mark::after { transform: rotate(-45deg); }
        
        /* Hit 3 - Green Circle */
        .h3 { border-color: var(--accent-success); background: rgba(16, 185, 129, 0.1); }
        .h3 .mark {
            width: 28px; height: 28px; border: 2.5px solid var(--accent-success); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .h3 .mark::after { content: '×'; color: var(--accent-success); font-size: 20px; font-weight: 800; margin-top: -2px; }

        /* --- Footer & DJ --- */
        .status { font-size: 15px; color: var(--text-gray); font-weight: 500; margin: 10px 0; }
        .status.win { color: var(--accent-success); font-weight: 700; }

        .dj-area { margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-subtle); }
        .dj-head { font-size: 13px; font-weight: 700; color: var(--accent-primary); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .dj-row { display: flex; gap: 8px; }
        .dj-btn {
            background: #27272a; color: var(--accent-success); border: 1px solid #3f3f46;
            border-radius: 12px; padding: 0 16px; font-weight: 600; cursor: pointer; min-width: 80px;
        }
        .dj-btn:active { background: #3f3f46; }

        /* --- Overlay --- */
        .modal-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 999; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-bg.open { opacity: 1; pointer-events: auto; }
        .modal {
            background: #18181b; border: 1px solid #333; width: 90%; max-width: 350px;
            padding: 24px; border-radius: 24px; text-align: center;
            transform: scale(0.9); transition: transform 0.3s;
        }
        .modal-bg.open .modal { transform: scale(1); }
        #winGif { width: 100%; height: auto; max-height: 60vh; border-radius: 16px; margin-bottom: 20px; object-fit: contain; background: #000; }

    </style>
</head>
<body>

    <div class="island-wrap">
        <div class="island" onclick="window.open('https://open.spotify.com/playlist/37i9dQZF1EJzGcYgpaOt8a?si=aZcbEZtaQTeDHAgOa5tQWQ&pi=Kq0CRvykRBaqq', '_blank')">
            <div class="island-left">
                <div class="eq-bars">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
                <div class="island-info">
                    <h4>Dart Zone</h4>
                    <p>Müzik Çalıyor</p>
                </div>
            </div>
            <div class="island-btn">Spotify</div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Dart Cricket</h1>
            <div class="subtitle">Pro Scoreboard</div>
        </header>

        <div id="setupView" class="card">
            <div class="tab-group">
                <button class="tab-btn active" id="btn2" onclick="setMode(2)">2 Oyuncu</button>
                <button class="tab-btn" id="btn3" onclick="setMode(3)">3 Oyuncu</button>
            </div>
            <div id="inputList"></div>
            <button class="btn-main" onclick="startGame()">Oyunu Başlat</button>
        </div>

        <div id="gameView" style="display:none;">
            <div id="grid" class="card board"></div>

            <div class="card">
                <div style="font-size:11px; text-transform:uppercase; color:#52525b; font-weight:700;">Durum</div>
                <div id="statusMsg" class="status">Oyun Bekleniyor</div>
                
                <div id="globalStats" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:12px;"></div>

                <div class="dj-area">
                    <div class="dj-head">
                        <span>✦ AI DJ</span>
                    </div>
                    <div class="dj-row">
                        <input type="text" id="djInput" placeholder="Modunu yaz (örn: 90lar pop, rock)..." style="font-size:14px;">
                        <button id="djActionBtn" class="dj-btn" onclick="runDJ()">Bul</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalOverlay" class="modal-bg">
        <div class="modal">
            <img id="winGif" src="winner.gif" alt="Winner">
            <h2 style="margin:0; color:#fff;">KAZANDI!</h2>
            <p id="winName" style="color:var(--accent-primary); font-weight:700; font-size:18px; text-transform:uppercase; margin:5px 0 20px 0;">---</p>
            <button class="btn-main" onclick="resetRound()">Yeni Oyun</button>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const TARGETS = ['20','19','18','17','16','15','D','T','B','H'];
        let pCount = 2;
        let players = []; // { name: "", scores: [] }
        let wins = {}; // { "Name": 5 }
        let active = false;

        // --- SETUP ---
        function init() { setMode(2); }

        function setMode(n) {
            pCount = n;
            document.getElementById('btn2').className = n===2 ? 'tab-btn active' : 'tab-btn';
            document.getElementById('btn3').className = n===3 ? 'tab-btn active' : 'tab-btn';
            
            let html = '';
            for(let i=0; i<n; i++) {
                html += `<div class="input-box"><input type="text" id="in${i}" placeholder="Oyuncu ${i+1}" value="Oyuncu ${i+1}"></div>`;
            }
            document.getElementById('inputList').innerHTML = html;
        }

        function startGame() {
            players = [];
            for(let i=0; i<pCount; i++) {
                let val = document.getElementById(`in${i}`).value.trim() || `P${i+1}`;
                players.push({ name: val, scores: new Array(TARGETS.length).fill(0) });
                if(!wins[val]) wins[val] = 0;
            }
            active = true;
            document.getElementById('setupView').style.display = 'none';
            document.getElementById('gameView').style.display = 'block';
            drawBoard();
            updateUI();
        }

        // --- GAMEPLAY ---
        window.tapCell = function(pIdx, tIdx) {
            if(!active) return;
            
            let sc = players[pIdx].scores[tIdx];
            // Cycle 0->1->2->3->0
            players[pIdx].scores[tIdx] = (sc >= 3) ? 0 : sc + 1;
            
            drawBoard();
            
            // Check win condition (Only if hit 3)
            if(players[pIdx].scores[tIdx] === 3) checkWinner(pIdx);
        };

        function checkWinner(pIdx) {
            // Player wins if ALL scores are 3
            let isWin = players[pIdx].scores.every(s => s === 3);
            if(isWin) {
                active = false;
                wins[players[pIdx].name]++;
                
                document.getElementById('winName').innerText = players[pIdx].name;
                
                // Gif Hack
                let img = document.getElementById('winGif');
                let src = img.src; img.src = ''; img.src = src;

                document.getElementById('modalOverlay').classList.add('open');
                updateUI(players[pIdx].name);
            }
        }

        window.resetRound = function() {
            players.forEach(p => p.scores.fill(0));
            active = true;
            document.getElementById('modalOverlay').classList.remove('open');
            drawBoard();
            updateUI();
        };

        // --- RENDER ---
        function drawBoard() {
            const grid = document.getElementById('grid');
            let h = '';

            if(pCount === 2) {
                grid.className = 'card board grid-2';
                h += `<div class="th">${players[0].name}</div><div class="th"></div><div class="th">${players[1].name}</div>`;
                TARGETS.forEach((t, i) => {
                    h += renderCell(0, i);
                    h += `<div class="target">${t}</div>`;
                    h += renderCell(1, i);
                });
            } else {
                grid.className = 'card board grid-3';
                h += `<div class="th"></div>`;
                players.forEach(p => h += `<div class="th">${p.name}</div>`);
                TARGETS.forEach((t, i) => {
                    h += `<div class="target">${t}</div>`;
                    players.forEach((p, pIdx) => h += renderCell(pIdx, i));
                });
            }
            grid.innerHTML = h;
        }

        function renderCell(pIdx, tIdx) {
            let s = players[pIdx].scores[tIdx];
            let c = 'cell';
            if(s===1) c += ' h1';
            if(s===2) c += ' h2';
            if(s===3) c += ' h3';
            return `<div class="${c}" onclick="tapCell(${pIdx},${tIdx})"><div class="mark"></div></div>`;
        }

        function updateUI(winner = null) {
            let msg = document.getElementById('statusMsg');
            if(winner) { msg.innerText = winner + " Kazandı!"; msg.className = 'status win'; }
            else { msg.innerText = "Maç devam ediyor..."; msg.className = 'status'; }

            let stats = '';
            for(let k in wins) {
                if(wins[k]>0) stats += `<div style="font-size:11px; background:#27272a; padding:4px 10px; border-radius:12px; border:1px solid #3f3f46;">${k}: ${wins[k]}</div>`;
            }
            document.getElementById('globalStats').innerHTML = stats;
        }

        // --- DJ LOGIC ---
        window.runDJ = function() {
            let inp = document.getElementById('djInput');
            let btn = document.getElementById('djActionBtn');
            let val = inp.value.trim().toLowerCase();

            if(!val) return;

            // UI Feedback
            let oldTxt = btn.innerText;
            btn.innerText = "...";
            inp.disabled = true;

            setTimeout(() => {
                // Smart Enhance
                if(val.includes('hareketli') || val.includes('kop')) val += ' party hits';
                else if(val.includes('sakin') || val.includes('chill')) val += ' chill vibes';
                else if(val.includes('90lar')) val += ' 90s türkçe pop';

                // Standard Search URL
                let url = 'https://open.spotify.com/search/' + encodeURIComponent(val);
                window.open(url, '_blank');

                btn.innerText = "✓";
                btn.style.color = "#10b981";
                
                setTimeout(() => {
                    btn.innerText = oldTxt;
                    btn.style.color = "";
                    inp.disabled = false;
                    inp.value = "";
                }, 2000);
            }, 1000);
        };

        init();
    </script>
</body>
</html>
