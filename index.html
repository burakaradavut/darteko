<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Dart Cricket Skor</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <style>
      :root {
        --bg-main: radial-gradient(circle at 0% -20%, #020617 0, #020617 40%, #020617 80%);
        --card-bg: radial-gradient(circle at 0% 0%, #0f172a 0, #020617 55%, #000000 100%);
        --card-border: rgba(148, 163, 184, 0.4);
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.2);
        --accent-neon: #22d3ee;
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, system-ui, "SF Pro Text",
          "Segoe UI", sans-serif;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        min-height: 100vh;
        background:
          radial-gradient(circle at 0% 0%, #0f172a 0, transparent 50%),
          radial-gradient(circle at 100% 0%, #4c1d95 0, transparent 55%),
          radial-gradient(circle at 50% 100%, #0f766e 0, transparent 60%),
          #020617;
        color: var(--text-main);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 16px;
      }

      .app-shell {
        width: 100%;
        max-width: 520px;
        margin-top: 8px;
        position: relative;
      }

      .app-shell::before {
        content: "";
        position: absolute;
        inset: -60px;
        pointer-events: none;
        background:
          radial-gradient(circle at 10% 0%, rgba(59, 130, 246, 0.35) 0, transparent 55%),
          radial-gradient(circle at 90% 0%, rgba(236, 72, 153, 0.4) 0, transparent 55%),
          radial-gradient(circle at 0% 100%, rgba(16, 185, 129, 0.35) 0, transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.8;
        filter: blur(2px);
      }

      .grain {
        position: absolute;
        inset: -40px;
        pointer-events: none;
        opacity: 0.18;
        mix-blend-mode: soft-light;
        background-image:
          linear-gradient(120deg, rgba(15, 23, 42, 0.6) 0.5px, transparent 0.5px),
          linear-gradient(60deg, rgba(148, 163, 184, 0.4) 0.5px, transparent 0.5px);
        background-size: 3px 5px, 4px 7px;
      }

      .status-pill {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.7);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        margin-bottom: 8px;
        font-size: 11px;
        color: var(--text-muted);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 0 25px rgba(59, 130, 246, 0.5);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow:
          0 0 0 4px rgba(34, 197, 94, 0.3),
          0 0 14px rgba(34, 197, 94, 0.9);
      }

      .card {
        position: relative;
        width: 100%;
        background: var(--card-bg);
        border-radius: 24px;
        padding: 18px 14px 20px;
        border: 1px solid var(--card-border);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 25px 60px rgba(15, 23, 42, 0.9),
          0 0 55px rgba(56, 189, 248, 0.28);
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: 0;
        background:
          radial-gradient(circle at 0% 0%, rgba(148, 163, 184, 0.18) 0, transparent 60%),
          radial-gradient(circle at 100% 0%, rgba(56, 189, 248, 0.2) 0, transparent 70%);
        opacity: 0.7;
        pointer-events: none;
      }

      .card-inner {
        position: relative;
        z-index: 1;
      }

      .header {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .title-wrap {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .title {
        font-size: 20px;
        font-weight: 600;
        letter-spacing: -0.02em;
      }

      .subtitle {
        font-size: 12px;
        color: var(--text-muted);
      }

      .badge {
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(59, 130, 246, 0.8);
        font-size: 11px;
        color: #dbeafe;
        background:
          radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.8) 0, rgba(56, 189, 248, 0.3) 45%, transparent 80%);
        box-shadow:
          0 0 22px rgba(56, 189, 248, 0.7),
          0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      /* Dynamic Island / Spotify */
      .dynamic-island {
        margin-bottom: 10px;
        display: flex;
        justify-content: center;
      }

      .dynamic-island-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 0;
        width: 100%;
        max-width: 380px;
        padding: 8px 14px;
        border-radius: 18px;
        background:
          radial-gradient(circle at 0% 0%, #020617 0, #020617 40%, #111827 100%);
        border: 1px solid rgba(15, 23, 42, 0.9);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 18px 40px rgba(15, 23, 42, 0.95),
          0 0 28px rgba(56, 189, 248, 0.55);
        text-decoration: none;
        color: #e5e7eb;
        cursor: pointer;
        overflow: hidden;
        position: relative;
      }

      .dynamic-island-inner::after {
        content: "";
        position: absolute;
        inset: 0;
        background:
          linear-gradient(120deg, rgba(148, 163, 184, 0.3) 0.5px, transparent 0.5px),
          linear-gradient(60deg, rgba(15, 23, 42, 0.4) 0.5px, transparent 0.5px);
        background-size: 4px 6px, 3px 5px;
        mix-blend-mode: soft-light;
        opacity: 0.6;
        pointer-events: none;
      }

      .dynamic-island-inner:hover {
        filter: brightness(1.05);
      }

      .di-left {
        display: flex;
        flex-direction: column;
        gap: 2px;
        font-size: 11px;
        position: relative;
        z-index: 1;
      }

      .di-left-main {
        font-size: 13px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .di-left-sub {
        color: #9ca3af;
      }

      .di-right {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 999px;
        background:
          radial-gradient(circle at 0% 0%, #22c55e 0, #16a34a 60%, #166534 100%);
        color: #ecfdf5;
        font-weight: 600;
        white-space: nowrap;
        position: relative;
        z-index: 1;
        box-shadow:
          0 0 0 1px rgba(6, 95, 39, 0.9),
          0 0 18px rgba(34, 197, 94, 0.8);
      }

      .di-dot {
        width: 14px;
        height: 14px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #22c55e, #16a34a);
        box-shadow:
          0 0 0 4px rgba(22, 163, 74, 0.4),
          0 0 18px rgba(34, 197, 94, 0.9);
        position: relative;
      }

      .di-dot::after {
        content: "";
        position: absolute;
        inset: 3px;
        border-radius: inherit;
        border: 2px solid rgba(0, 0, 0, 0.7);
      }

      .section {
        margin-top: 10px;
      }

      .controls {
        padding: 10px;
        border-radius: 16px;
        background:
          radial-gradient(circle at 0% 0%, #111827 0, #020617 60%);
        border: 1px solid rgba(148, 163, 184, 0.6);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 16px 35px rgba(15, 23, 42, 0.85);
      }

      .controls-row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      label {
        font-size: 12px;
        color: var(--text-muted);
      }

      select,
      input[type="text"],
      button,
      textarea {
        border-radius: 12px;
        border: none;
        padding: 9px 11px;
        font-size: 13px;
      }

      select,
      input[type="text"],
      textarea {
        background: rgba(15, 23, 42, 0.95);
        color: #e5e7eb;
        border: 1px solid rgba(55, 65, 81, 0.9);
        flex: 1;
        min-width: 0;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 0 20px rgba(56, 189, 248, 0.18);
      }

      textarea {
        resize: vertical;
        min-height: 54px;
      }

      input::placeholder,
      textarea::placeholder {
        color: #6b7280;
      }

      .btn-row {
        display: flex;
        gap: 8px;
        width: 100%;
        margin-top: 4px;
      }

      .btn-primary {
        background:
          radial-gradient(circle at 0% 0%, #38bdf8, #0ea5e9 35%, #22d3ee 80%),
          linear-gradient(135deg, #0ea5e9, #22d3ee);
        color: #ecfeff;
        font-weight: 600;
        cursor: pointer;
        flex: 1;
        min-width: 130px;
        box-shadow:
          0 10px 28px rgba(56, 189, 248, 0.7),
          0 0 25px rgba(56, 189, 248, 0.9),
          0 0 0 1px rgba(15, 23, 42, 1);
        position: relative;
        overflow: hidden;
      }

      .btn-primary::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image:
          linear-gradient(120deg, rgba(191, 219, 254, 0.45) 0.5px, transparent 0.5px),
          linear-gradient(60deg, rgba(15, 23, 42, 0.3) 0.5px, transparent 0.5px);
        background-size: 4px 6px, 3px 5px;
        mix-blend-mode: soft-light;
        opacity: 0.8;
        pointer-events: none;
      }

      .btn-secondary {
        background:
          radial-gradient(circle at 0% 0%, #1d283a, #020617 50%, #0f172a 100%);
        color: #e5e7eb;
        cursor: pointer;
        font-size: 12px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        min-width: 110px;
        font-weight: 500;
        position: relative;
        overflow: hidden;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 0 20px rgba(148, 163, 184, 0.4);
      }

      .btn-secondary::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image:
          linear-gradient(120deg, rgba(148, 163, 184, 0.35) 0.5px, transparent 0.5px),
          linear-gradient(60deg, rgba(15, 23, 42, 0.35) 0.5px, transparent 0.5px);
        background-size: 4px 6px, 3px 5px;
        mix-blend-mode: soft-light;
        opacity: 0.75;
        pointer-events: none;
      }

      .btn-primary:active,
      .btn-secondary:active {
        opacity: 0.96;
        box-shadow: none;
        transform: translateY(1px);
      }

      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .back-btn {
        border-radius: 999px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: rgba(15, 23, 42, 0.95);
        padding: 6px 10px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        color: #e5e7eb;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 10px 22px rgba(15, 23, 42, 0.9);
      }

      .back-btn span {
        font-size: 16px;
      }

      .screen {
        display: none;
      }

      .screen.active {
        display: block;
      }

      .scoreboard-wrapper {
        margin-top: 4px;
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid rgba(75, 85, 99, 0.9);
        background:
          radial-gradient(circle at 0% 0%, #020617 0, #020617 50%, #020617 100%);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 18px 40px rgba(15, 23, 42, 0.95);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }

      thead {
        background:
          linear-gradient(90deg, rgba(15, 23, 42, 0.95), rgba(30, 64, 175, 0.9));
      }

      th,
      td {
        padding: 10px 4px;
        text-align: center;
        font-size: 14px;
        color: #e5e7eb;
      }

      th:first-child,
      td:first-child {
        text-align: left;
        padding-left: 12px;
      }

      th {
        font-weight: 500;
        border-bottom: 1px solid rgba(55, 65, 81, 0.9);
        color: #cbd5f5;
      }

      tbody tr:nth-child(odd) {
        background: rgba(15, 23, 42, 0.95);
      }

      tbody tr:nth-child(even) {
        background: rgba(15, 23, 42, 0.9);
      }

      td.cell-clickable {
        cursor: pointer;
        user-select: none;
        font-weight: 700;
        font-size: 20px;
        min-height: 40px;
        transition: background 0.12s ease-out, transform 0.06s ease-out,
          box-shadow 0.12s ease-out;
      }

      td.cell-clickable.tap {
        background: rgba(56, 189, 248, 0.15);
        box-shadow:
          inset 0 0 0 1px rgba(56, 189, 248, 0.65),
          0 0 18px rgba(56, 189, 248, 0.8);
      }

      .summary {
        margin-top: 10px;
        padding: 10px 11px;
        border-radius: 14px;
        background:
          radial-gradient(circle at 0% 0%, rgba(15, 23, 42, 0.95) 0, #020617 60%);
        border: 1px solid rgba(75, 85, 99, 0.95);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 16px 32px rgba(15, 23, 42, 0.9);
      }

      .summary-title {
        font-size: 12px;
        font-weight: 600;
        color: var(--accent-neon);
        margin-bottom: 6px;
        letter-spacing: 0.03em;
        text-transform: uppercase;
      }

      .game-status {
        font-size: 13px;
        margin-bottom: 6px;
      }

      .score-summary {
        font-size: 12px;
        color: var(--text-muted);
      }

      .score-summary span {
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 2px;
      }

      .score-summary strong {
        color: var(--accent-neon);
      }

      .round-title {
        font-size: 11px;
        font-weight: 600;
        color: #a5b4fc;
        margin-top: 8px;
        margin-bottom: 4px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .game-status.win {
        color: #22c55e;
      }

      .game-status.tie {
        color: #fbbf24;
      }

      .game-status.running {
        color: var(--text-muted);
      }

      /* Winner overlay (GIF) */
      .winner-overlay {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.28), rgba(15, 23, 42, 0.9));
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 50;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .winner-overlay.active {
        display: flex;
      }

      .winner-inner {
        background:
          radial-gradient(circle at 0% 0%, rgba(15, 23, 42, 1) 0, #020617 60%);
        border-radius: 24px;
        padding: 14px 14px 16px;
        max-width: 320px;
        width: 90%;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 26px 55px rgba(15, 23, 42, 0.95),
          0 0 40px rgba(56, 189, 248, 0.8);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .winner-inner::before {
        content: "";
        position: absolute;
        inset: -40%;
        background:
          radial-gradient(circle at 0% 0%, rgba(129, 140, 248, 0.45) 0, transparent 50%),
          radial-gradient(circle at 100% 0%, rgba(56, 189, 248, 0.4) 0, transparent 55%);
        mix-blend-mode: screen;
        opacity: 0.9;
        pointer-events: none;
      }

      .winner-gif-wrap {
        border-radius: 18px;
        overflow: hidden;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 0 30px rgba(56, 189, 248, 0.8);
      }

      .winner-gif-wrap img {
        display: block;
        width: 100%;
        height: auto;
      }

      .winner-text {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #e5e7eb;
        position: relative;
        z-index: 1;
      }

      .winner-sub {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .btn-small {
        font-size: 12px;
        padding: 7px 10px;
        min-width: 0;
      }

      /* ÅžarkÄ± istek kutusu */
      .music-box {
        margin-top: 12px;
        padding: 10px;
        border-radius: 14px;
        background:
          radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.16), rgba(15, 23, 42, 0.95));
        border: 1px solid rgba(56, 189, 248, 0.7);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 1),
          0 16px 32px rgba(15, 23, 42, 0.9),
          0 0 30px rgba(56, 189, 248, 0.6);
      }

      .music-title {
        font-size: 12px;
        font-weight: 600;
        color: var(--accent-neon);
        margin-bottom: 6px;
        letter-spacing: 0.03em;
        text-transform: uppercase;
      }

      .music-hint {
        font-size: 11px;
        color: #9ca3af;
        margin-bottom: 6px;
      }

      @media (max-width: 430px) {
        body {
          padding: 10px;
        }

        .card {
          padding: 14px 12px 18px;
        }

        th,
        td {
          font-size: 13px;
          padding: 8px 3px;
        }

        td.cell-clickable {
          font-size: 18px;
          min-height: 36px;
        }

        .title {
          font-size: 18px;
        }

        .dynamic-island-inner {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <div class="grain"></div>
      <div class="status-pill">
        <div class="status-dot"></div>
        <span>Dart Cricket Â· canlÄ± skor tahtasÄ±</span>
      </div>

      <!-- Kazanan GIF overlay -->
      <div id="winnerOverlay" class="winner-overlay">
        <div class="winner-inner">
          <div class="winner-gif-wrap">
            <img
              id="winnerGif"
              src="winner.gif"
              alt="Kazanan"
            />
          </div>
          <div id="winnerText" class="winner-text"></div>
          <div class="winner-sub">Yeni tur iÃ§in iÅŸaretleri temizle.</div>
          <button id="closeOverlayBtn" class="btn-primary btn-small">
            Tamam
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-inner">
          <!-- Dynamic Island / Spotify playlist -->
          <div class="dynamic-island">
            <a
              class="dynamic-island-inner"
              href="https://open.spotify.com/playlist/37i9dQZF1EJzGcYgpaOt8a?si=4ad5383ce6fd48a0"
              target="_blank"
              rel="noopener noreferrer"
            >
              <div class="di-left">
                <div class="di-left-main">
                  <span class="di-dot"></span>
                  <span>ðŸŽ§ Dart mode playlist</span>
                </div>
                <div class="di-left-sub">
                  OklarÄ± hazÄ±rlarken aÃ§, herkes Ä±sÄ±nsÄ±n
                </div>
              </div>
              <div class="di-right">
                <span>Spotify aÃ§</span>
                <span>â–¸</span>
              </div>
            </a>
          </div>

          <!-- SETUP EKRANI -->
          <div id="setupScreen" class="screen active">
            <div class="header">
              <div class="title-wrap">
                <div class="title">Dart Cricket Skor</div>
                <div class="subtitle">
                  OyuncularÄ± seÃ§ ve baÅŸlat
                </div>
              </div>
              <div class="badge">3 oyuncuya kadar</div>
            </div>

            <div class="section controls">
              <div class="controls-row">
                <label for="playerCount">Oyuncu sayÄ±sÄ±:</label>
                <select id="playerCount">
                  <option value="1">1 oyuncu</option>
                  <option value="2" selected>2 oyuncu</option>
                  <option value="3">3 oyuncu</option>
                </select>
              </div>
              <div class="controls-row">
                <input
                  type="text"
                  id="player1"
                  placeholder="Oyuncu 1"
                  value="Oyuncu 1"
                />
              </div>
              <div class="controls-row">
                <input
                  type="text"
                  id="player2"
                  placeholder="Oyuncu 2"
                  value="Oyuncu 2"
                />
              </div>
              <div class="controls-row">
                <input
                  type="text"
                  id="player3"
                  placeholder="Oyuncu 3"
                  value="Oyuncu 3"
                />
              </div>
              <div class="btn-row">
                <button class="btn-primary" id="startBtn">
                  Oyunu BaÅŸlat
                </button>
              </div>
            </div>
          </div>

          <!-- OYUN EKRANI -->
          <div id="gameScreen" class="screen">
            <div class="top-bar">
              <button id="backBtn" class="back-btn">
                <span>â€¹</span> Oyuncular
              </button>
              <div class="subtitle">Skor tahtasÄ±</div>
            </div>

            <div class="section">
              <div class="scoreboard-wrapper">
                <table id="scoreTable"></table>
              </div>

              <div class="summary">
                <div class="summary-title">AnlÄ±k Durum</div>
                <div id="gameStatus" class="game-status running">
                  Oyun devam ediyor
                </div>
                <div id="scoreSummary" class="score-summary">
                  HenÃ¼z kapatÄ±lmÄ±ÅŸ hedef yok.
                </div>

                <div class="round-title">Genel Puanlama</div>
                <div id="globalSummary" class="score-summary">
                  HenÃ¼z kimse oyun kazanmadÄ±.
                </div>

                <!-- ÅžarkÄ± istek kutusu -->
                <div class="music-box">
                  <div class="music-title">ÅžarkÄ± iste</div>
                  <div class="music-hint">
                    NasÄ±l bir ÅŸarkÄ± istiyorsun? Mesela
                    "enerjik rock", "sakin jazz", "80ler pop", "romantik slow" gibi yaz.
                  </div>
                  <textarea
                    id="songRequest"
                    placeholder="Ã–rnek: enerjik modern rock, kadÄ±n vokal, tempo yÃ¼ksek"
                  ></textarea>
                  <div class="btn-row" style="margin-top: 6px;">
                    <button class="btn-secondary" id="songRequestBtn">
                      Spotifyda bul
                    </button>
                  </div>
                </div>
              </div>

              <div class="btn-row" style="margin-top: 8px;">
                <button class="btn-secondary" id="resetMarksBtn">
                  Ä°ÅŸaretleri temizle
                </button>
                <button class="btn-primary" id="newGameBtn">
                  Yeni oyun
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        var targets = ["20", "19", "18", "17", "16", "15", "D", "T", "B", "H"];

        var playerCountSelect = document.getElementById("playerCount");
        var playerInputs = [
          document.getElementById("player1"),
          document.getElementById("player2"),
          document.getElementById("player3"),
        ];

        var setupScreen = document.getElementById("setupScreen");
        var gameScreen = document.getElementById("gameScreen");

        var startBtn = document.getElementById("startBtn");
        var backBtn = document.getElementById("backBtn");
        var resetMarksBtn = document.getElementById("resetMarksBtn");
        var newGameBtn = document.getElementById("newGameBtn");

        var scoreTable = document.getElementById("scoreTable");
        var gameStatusEl = document.getElementById("gameStatus");
        var scoreSummaryEl = document.getElementById("scoreSummary");
        var globalSummaryEl = document.getElementById("globalSummary");

        var winnerOverlay = document.getElementById("winnerOverlay");
        var winnerTextEl = document.getElementById("winnerText");
        var closeOverlayBtn = document.getElementById("closeOverlayBtn");

        var songRequestInput = document.getElementById("songRequest");
        var songRequestBtn = document.getElementById("songRequestBtn");

        var gameOver = false;
        var currentNames = [];
        var currentPlayerCount = 0;

        // Genel puanlama: isim -> kazandÄ±ÄŸÄ± oyun sayÄ±sÄ±
        var globalWins = {};

        function nextMark(current) {
          var order = ["", "/", "x", "â“§"];
          var idx = order.indexOf(current);
          if (idx === -1 || idx === order.length - 1) {
            return order[0];
          }
          return order[idx + 1];
        }

        function updateGlobalSummary() {
          var keys = Object.keys(globalWins);
          if (keys.length === 0) {
            globalSummaryEl.textContent = "HenÃ¼z kimse oyun kazanmadÄ±.";
            return;
          }
          var html = "";
          keys.forEach(function (name) {
            html +=
              '<span><strong>' +
              name +
              "</strong>: " +
              globalWins[name] +
              " oyun</span>";
          });
          globalSummaryEl.innerHTML = html;
        }

        function showWinnerOverlay(winnerName) {
          winnerTextEl.textContent = winnerName + " bu oyunu kazandÄ± ðŸŽ¯";
          winnerOverlay.classList.add("active");
        }

        function hideWinnerOverlay() {
          winnerOverlay.classList.remove("active");
        }

        closeOverlayBtn.addEventListener("click", hideWinnerOverlay);
        winnerOverlay.addEventListener("click", function (e) {
          if (e.target === winnerOverlay) hideWinnerOverlay();
        });

        function updateGlobalScore() {
          var playerCount = currentPlayerCount;
          var names = currentNames;
          if (!playerCount || !names || names.length === 0) return;

          var closedCounts = new Array(playerCount);
          for (var i = 0; i < playerCount; i++) closedCounts[i] = 0;

          var cells = scoreTable.querySelectorAll("td.cell-clickable");
          for (var j = 0; j < cells.length; j++) {
            var td = cells[j];
            var p = parseInt(td.getAttribute("data-player"), 10);
            if (!isNaN(p) && td.getAttribute("data-count") === "3") {
              closedCounts[p] += 1;
            }
          }

          var summaryText = "";
          for (var k = 0; k < closedCounts.length; k++) {
            var count = closedCounts[k];
            var name = names[k] || "Oyuncu " + (k + 1);
            summaryText +=
              '<span><strong>' +
              name +
              "</strong>: " +
              count +
              "/" +
              targets.length +
              "</span>";
          }
          scoreSummaryEl.innerHTML =
            summaryText || "HenÃ¼z kapatÄ±lmÄ±ÅŸ hedef yok.";

          var winnerIndices = [];
          for (var w = 0; w < closedCounts.length; w++) {
            if (closedCounts[w] === targets.length) {
              winnerIndices.push(w);
            }
          }

          if (winnerIndices.length > 0) {
            if (!gameOver) {
              if (winnerIndices.length === 1) {
                var idx = winnerIndices[0];
                var winnerName = names[idx] || "Oyuncu " + (idx + 1);

                // Genel puanlama
                globalWins[winnerName] = (globalWins[winnerName] || 0) + 1;
                updateGlobalSummary();

                showWinnerOverlay(winnerName);
                gameStatusEl.textContent =
                  "Oyun bitti Â· " + winnerName + " tÃ¼m hedefleri kapattÄ±";
                gameStatusEl.className = "game-status win";
              } else {
                gameStatusEl.textContent =
                  "Oyun bitti Â· birden fazla oyuncu tÃ¼m hedefleri kapattÄ± (berabere)";
                gameStatusEl.className = "game-status tie";
              }
            }
            gameOver = true;
          } else {
            if (!gameOver) {
              gameStatusEl.textContent = "Oyun devam ediyor";
              gameStatusEl.className = "game-status running";
            }
          }
        }

        function attachCellHandlers(td) {
          td.addEventListener("click", function () {
            if (gameOver) return;

            var currentDisplay = td.textContent || "";
            var next = nextMark(currentDisplay);
            td.textContent = next;

            if (next === "") {
              td.setAttribute("data-count", "0");
            } else if (next === "/") {
              td.setAttribute("data-count", "1");
            } else if (next === "x") {
              td.setAttribute("data-count", "2");
            } else if (next === "â“§") {
              td.setAttribute("data-count", "3");
            }

            td.classList.add("tap");
            setTimeout(function () {
              td.classList.remove("tap");
            }, 140);

            updateGlobalScore();
          });
        }

        function buildTable() {
          var playerCount = parseInt(playerCountSelect.value, 10);
          var names = [];

          for (var i = 0; i < playerCount; i++) {
            var val = playerInputs[i].value;
            var name =
              val && val.trim()
                ? val.trim()
                : "Oyuncu " + (i + 1);
            names.push(name);
          }

          currentPlayerCount = playerCount;
          currentNames = names;
          gameOver = false;

          scoreTable.innerHTML = "";

          var thead = document.createElement("thead");
          var headRow = document.createElement("tr");

          if (playerCount === 2) {
            var thP1 = document.createElement("th");
            thP1.textContent = names[0];
            headRow.appendChild(thP1);

            var thTarget = document.createElement("th");
            thTarget.textContent = "Hedef";
            headRow.appendChild(thTarget);

            var thP2 = document.createElement("th");
            thP2.textContent = names[1];
            headRow.appendChild(thP2);
          } else {
            var thTargetLeft = document.createElement("th");
            thTargetLeft.textContent = "Hedef";
            headRow.appendChild(thTargetLeft);

            for (var p = 0; p < names.length; p++) {
              var th = document.createElement("th");
              th.textContent = names[p];
              headRow.appendChild(th);
            }
          }

          thead.appendChild(headRow);
          scoreTable.appendChild(thead);

          var tbody = document.createElement("tbody");

          for (var t = 0; t < targets.length; t++) {
            var target = targets[t];
            var tr = document.createElement("tr");

            if (playerCount === 2) {
              var tdP1 = document.createElement("td");
              tdP1.className = "cell-clickable";
              tdP1.setAttribute("data-count", "0");
              tdP1.setAttribute("data-player", "0");
              tdP1.setAttribute("data-target", target);
              tdP1.textContent = "";
              attachCellHandlers(tdP1);
              tr.appendChild(tdP1);

              var tdLabelMid = document.createElement("td");
              tdLabelMid.textContent = target;
              tr.appendChild(tdLabelMid);

              var tdP2 = document.createElement("td");
              tdP2.className = "cell-clickable";
              tdP2.setAttribute("data-count", "0");
              tdP2.setAttribute("data-player", "1");
              tdP2.setAttribute("data-target", target);
              tdP2.textContent = "";
              attachCellHandlers(tdP2);
              tr.appendChild(tdP2);
            } else {
              var tdLabel = document.createElement("td");
              tdLabel.textContent = target;
              tr.appendChild(tdLabel);

              for (var idx = 0; idx < names.length; idx++) {
                var td = document.createElement("td");
                td.className = "cell-clickable";
                td.setAttribute("data-count", "0");
                td.setAttribute("data-player", String(idx));
                td.setAttribute("data-target", target);
                td.textContent = "";
                attachCellHandlers(td);
                tr.appendChild(td);
              }
            }

            tbody.appendChild(tr);
          }

          scoreTable.appendChild(tbody);

          gameStatusEl.textContent = "Oyun devam ediyor";
          gameStatusEl.className = "game-status running";
          scoreSummaryEl.textContent = "HenÃ¼z kapatÄ±lmÄ±ÅŸ hedef yok.";
        }

        function showSetup() {
          setupScreen.classList.add("active");
          gameScreen.classList.remove("active");
        }

        function showGame() {
          setupScreen.classList.remove("active");
          gameScreen.classList.add("active");
        }

        function resetMarksOnly() {
          var cells = scoreTable.querySelectorAll("td.cell-clickable");
          for (var i = 0; i < cells.length; i++) {
            var td = cells[i];
            td.textContent = "";
            td.setAttribute("data-count", "0");
            td.classList.remove("tap");
          }
          gameOver = false;
          gameStatusEl.textContent = "Oyun devam ediyor";
          gameStatusEl.className = "game-status running";
          scoreSummaryEl.textContent = "HenÃ¼z kapatÄ±lmÄ±ÅŸ hedef yok.";
          hideWinnerOverlay();
        }

        startBtn.addEventListener("click", function () {
          buildTable();
          showGame();
        });

        backBtn.addEventListener("click", function () {
          showSetup();
        });

        resetMarksBtn.addEventListener("click", function () {
          resetMarksOnly();
        });

        newGameBtn.addEventListener("click", function () {
          resetMarksOnly();
          showSetup();
        });

        // ÅžarkÄ± iste Spotify entegrasyonu:
        // basit bir keyword kontrolÃ¼ ve yoksa genel search
        function getSpotifyUrlFromDescription(text) {
          var q = text.toLowerCase();

          // birkaÃ§ hazÄ±r mood / stil
          if (q.includes("jazz") || q.includes("caz")) {
            return "https://open.spotify.com/playlist/37i9dQZF1DXbITWG1ZJKYt"; // jazz vibes
          }
          if (q.includes("80") || q.includes("80ler") || q.includes("80s")) {
            return "https://open.spotify.com/playlist/37i9dQZF1DX4UtSsGT1Sbe"; // 80s pop
          }
          if (q.includes("rock")) {
            if (q.includes("soft") || q.includes("yumuÅŸak") || q.includes("slow")) {
              return "https://open.spotify.com/playlist/37i9dQZF1DWXRqgorJj26U"; // soft rock
            }
            return "https://open.spotify.com/playlist/37i9dQZF1DXcF6B6QPhFDv"; // rock classics
          }
          if (q.includes("enerjik") || q.includes("energetic") || q.includes("yÃ¼ksek tempo")) {
            return "https://open.spotify.com/playlist/37i9dQZF1DX8tZsk68tuDw"; // beast mode
          }
          if (q.includes("chill") || q.includes("sakin") || q.includes("lofi") || q.includes("lo fi")) {
            return "https://open.spotify.com/playlist/37i9dQZF1DX4WYpdgoIcn6"; // lofi beats
          }
          if (q.includes("romantik") || q.includes("love") || q.includes("aÅŸk")) {
            return "https://open.spotify.com/playlist/37i9dQZF1DXb9LIXaj5WhL"; // love pop
          }

          // Ã¶zel bir ÅŸey yakalayamazsa Spotify search
          var encoded = encodeURIComponent(text);
          return "https://open.spotify.com/search/" + encoded;
        }

        songRequestBtn.addEventListener("click", function () {
          var text = songRequestInput.value.trim();
          if (!text) {
            alert("Ã–nce nasÄ±l bir ÅŸarkÄ± istediÄŸini yaz.");
            return;
          }
          var url = getSpotifyUrlFromDescription(text);
          window.open(url, "_blank");
        });
      })();
    </script>
  </body>
</html>